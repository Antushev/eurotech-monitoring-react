import React, { useEffect, useRef } from 'react';
import { useSelector, useDispatch } from 'react-redux';

import { deleteLink } from '../../store/api-actions.js';

import { getStatusLoadLink } from '../../store/app-data/selectors.js';

import Preloader from '../../components/preloader/preloader.jsx';

const WIDTH_PRELOADER = 15;
const HEIGHT_PRELOADER = 15;
const COLOR_PRELOADER = '#000000';

const DialogWindowEditLink = (props) => {
  const dispatch = useDispatch();

  const {
    isOpen,
    setIsOpen,
    setIsOpenPopupEditLink,
    stat
  } = props;

  const isLoadLink = useSelector(getStatusLoadLink);

  const useOutsideClick = (ref) => {
    useEffect(() => {
      const handleClickOutside = (evt) => {
        if (
          isOpen
          && ref.current
          && !ref.current.contains(evt.target)
          && !document.querySelector('.background-black')
        ) {
          setIsOpen({});
        }
      }

      window.addEventListener('mousedown', handleClickOutside);

      return () => {
        removeEventListener('mousedown', handleClickOutside);
      }
    }, []);
  }

  const wrapperRef = useRef();
  useOutsideClick(wrapperRef);

  return (
    <div
      ref={wrapperRef}
      className={
        isOpen ? 'dialog-window' : 'dialog-window visually-hidden'
      }
    >
      <ul
        className='dialog-list'
        onClick={(evt) => {
          evt.preventDefault();
          evt.cancelBubble = true;
          evt.stopPropagation();
        }}
      >
        <li
          className="dialog-list__item"
          onClick={(evt) => {
            evt.stopPropagation();
          }}
        >
          <a className="dialog-list__item" href={`${stat.linkProduct}`} target="_blank">
            <div className="dialog-list__icon-block">
              <svg className="dialog-list__icon" width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M9.78628 5.93402C11.42 7.56942 11.3976 10.1914 9.79612 11.8017C9.79312 11.805 9.78956 11.8086 9.78628 11.8118L7.94878 13.6493C6.32812 15.27 3.69139 15.2698 2.07097 13.6493C0.450303 12.0289 0.450303 9.39191 2.07097 7.77152L3.08558 6.7569C3.35465 6.48784 3.81801 6.66667 3.83191 7.04691C3.84962 7.5315 3.93652 8.01835 4.09687 8.4885C4.15117 8.6477 4.11237 8.82379 3.99342 8.94273L3.63558 9.30058C2.86924 10.0669 2.84521 11.3147 3.60399 12.0886C4.37028 12.87 5.62978 12.8747 6.40194 12.1025L8.23944 10.2653C9.01029 9.49442 9.00707 8.24848 8.23944 7.48086C8.13825 7.37985 8.03631 7.30137 7.95668 7.24655C7.90035 7.20787 7.85384 7.15655 7.82086 7.09671C7.78788 7.03686 7.76934 6.97013 7.76673 6.90185C7.7559 6.61291 7.85827 6.31516 8.08659 6.08684L8.66229 5.51112C8.81325 5.36016 9.05008 5.34162 9.22513 5.46379C9.42561 5.60378 9.61338 5.76113 9.78628 5.93402ZM13.64 2.08014C12.0196 0.45969 9.38282 0.459471 7.76216 2.08014L5.92466 3.91764C5.92138 3.92092 5.91782 3.92447 5.91482 3.92775C4.3134 5.53808 4.29095 8.16005 5.92466 9.79545C6.09755 9.96834 6.28531 10.1257 6.48578 10.2657C6.66084 10.3878 6.89769 10.3693 7.04862 10.2183L7.62432 9.6426C7.85264 9.41428 7.95501 9.11653 7.94419 8.82759C7.94157 8.75931 7.92303 8.69258 7.89005 8.63273C7.85707 8.57289 7.81056 8.52158 7.75423 8.48289C7.67461 8.42807 7.57267 8.34959 7.47147 8.24859C6.70385 7.48096 6.70062 6.23502 7.47147 5.46417L9.30897 3.62694C10.0811 2.85478 11.3406 2.85943 12.1069 3.64089C12.8657 4.41472 12.8417 5.66252 12.0753 6.42886L11.7175 6.78671C11.5985 6.90565 11.5597 7.08175 11.614 7.24094C11.7744 7.71109 11.8613 8.19794 11.879 8.68253C11.8929 9.06277 12.3563 9.2416 12.6253 8.97254L13.6399 7.95792C15.2606 6.33756 15.2606 3.70053 13.64 2.08014Z" fill="black"/>
              </svg>
            </div>

            <span className="dialog-list__text">
              Перейти по ссылке
            </span>
          </a>

        </li>
        <li
          className="dialog-list__item"
          onClick={() => {
            setIsOpenPopupEditLink(true);
          }}
        >
          <div className="dialog-list__icon-block">
            <svg className="dialog-list__icon" width="14" height="13" viewBox="0 0 14 13">
              <path d="M9.78542 2.01979L11.9778 4.21215C12.0701 4.30451 12.0701 4.45521 11.9778 4.54757L6.66944 9.8559L4.41389 10.1062C4.1125 10.1403 3.85729 9.88507 3.89132 9.58368L4.14167 7.32812L9.45 2.01979C9.54236 1.92743 9.69306 1.92743 9.78542 2.01979ZM13.7229 1.46319L12.5368 0.277083C12.1674 -0.0923611 11.567 -0.0923611 11.1951 0.277083L10.3347 1.1375C10.2424 1.22986 10.2424 1.38056 10.3347 1.47292L12.5271 3.66528C12.6194 3.75764 12.7701 3.75764 12.8625 3.66528L13.7229 2.80486C14.0924 2.43299 14.0924 1.83264 13.7229 1.46319ZM9.33333 8.41215V10.8865H1.55556V3.10868H7.14097C7.21875 3.10868 7.29167 3.07708 7.34757 3.02361L8.31979 2.05139C8.50451 1.86667 8.37326 1.55312 8.11319 1.55312H1.16667C0.52257 1.55312 0 2.07569 0 2.71979V11.2753C0 11.9194 0.52257 12.442 1.16667 12.442H9.72222C10.3663 12.442 10.8889 11.9194 10.8889 11.2753V7.43993C10.8889 7.17986 10.5753 7.05104 10.3906 7.23333L9.4184 8.20555C9.36493 8.26146 9.33333 8.33437 9.33333 8.41215Z" fill="black"/>
            </svg>
          </div>

          <span className="dialog-list__text">
            Редактировать ссылку
          </span>
        </li>

        <li
          className="dialog-list__item"
          onClick={async () => {
            await dispatch(deleteLink(stat.idLink));
          }}
        >
          <div className="dialog-list__icon-block">
            <svg className="dialog-list__icon" width="11" height="12" viewBox="0 0 11 12">
              <path d="M0.75 10.875C0.75 11.1734 0.868526 11.4595 1.0795 11.6705C1.29048 11.8815 1.57663 12 1.875 12H8.625C8.92337 12 9.20951 11.8815 9.42049 11.6705C9.63147 11.4595 9.75 11.1734 9.75 10.875V3H0.75V10.875ZM7.125 4.875C7.125 4.77555 7.16451 4.68016 7.23483 4.60984C7.30516 4.53951 7.40054 4.5 7.5 4.5C7.59945 4.5 7.69484 4.53951 7.76516 4.60984C7.83549 4.68016 7.875 4.77555 7.875 4.875V10.125C7.875 10.2245 7.83549 10.3198 7.76516 10.3902C7.69484 10.4605 7.59945 10.5 7.5 10.5C7.40054 10.5 7.30516 10.4605 7.23483 10.3902C7.16451 10.3198 7.125 10.2245 7.125 10.125V4.875ZM4.875 4.875C4.875 4.77555 4.91451 4.68016 4.98483 4.60984C5.05516 4.53951 5.15054 4.5 5.25 4.5C5.34945 4.5 5.44484 4.53951 5.51516 4.60984C5.58549 4.68016 5.625 4.77555 5.625 4.875V10.125C5.625 10.2245 5.58549 10.3198 5.51516 10.3902C5.44484 10.4605 5.34945 10.5 5.25 10.5C5.15054 10.5 5.05516 10.4605 4.98483 10.3902C4.91451 10.3198 4.875 10.2245 4.875 10.125V4.875ZM2.625 4.875C2.625 4.77555 2.66451 4.68016 2.73483 4.60984C2.80516 4.53951 2.90054 4.5 3 4.5C3.09946 4.5 3.19484 4.53951 3.26516 4.60984C3.33549 4.68016 3.375 4.77555 3.375 4.875V10.125C3.375 10.2245 3.33549 10.3198 3.26516 10.3902C3.19484 10.4605 3.09946 10.5 3 10.5C2.90054 10.5 2.80516 10.4605 2.73483 10.3902C2.66451 10.3198 2.625 10.2245 2.625 10.125V4.875ZM10.125 0.750004H7.3125L7.09219 0.311723C7.04552 0.218023 6.97363 0.139205 6.8846 0.084135C6.79558 0.0290653 6.69296 -7.09679e-05 6.58828 4.10923e-06H3.90937C3.80493 -0.000397388 3.70249 0.0286302 3.61378 0.0837612C3.52507 0.138892 3.45369 0.217897 3.40781 0.311723L3.1875 0.750004H0.375C0.275544 0.750004 0.180161 0.789513 0.109835 0.859839C0.0395088 0.930165 0 1.02555 0 1.125L0 1.875C0 1.97446 0.0395088 2.06984 0.109835 2.14017C0.180161 2.21049 0.275544 2.25 0.375 2.25H10.125C10.2245 2.25 10.3198 2.21049 10.3902 2.14017C10.4605 2.06984 10.5 1.97446 10.5 1.875V1.125C10.5 1.02555 10.4605 0.930165 10.3902 0.859839C10.3198 0.789513 10.2245 0.750004 10.125 0.750004Z" fill="black"/>
            </svg>
          </div>

          <span className="dialog-list__text">
            Удалить ссылку
          </span>

          {
            isLoadLink &&
              <Preloader
                width={WIDTH_PRELOADER}
                height={HEIGHT_PRELOADER}
                color={COLOR_PRELOADER}
              />
          }
        </li>

      </ul>
    </div>
  );
}

export default DialogWindowEditLink;
